var requireindex = require('requireindex'),
	 controllers = requireindex("./Controllers")
	 ext = require("./ext");


exports.server = require("./server.js");
exports.view = require("./view.js");

//since we have to restart app.js in order to add new pages we can safely grab the sitemap once and not worry with it until the server has been released.
var _siteMap = null;
exports.SiteMap = function(){ _siteMap = _siteMap == null ? fetchMenu(controllers, "", "") : _siteMap; return _siteMap; }

function fetchMenu(object, path, title)
{
	var sm = [];

	for(var p in object)
	{
		tmpPath = path + "/" + p;
		if(p == exports.server.defaultPath)
		{
			tmpPath = "/";//homepage
		}
		p = p.replace(/_/gi, " ");//use underscore in file/function names to denote a space.
		p = p.toTitleCase();//stupid callbacks, TODO: I guess use async forEach to make this work.  Do in CSS for now.
		sm.push({ name: p, path: tmpPath, children: fetchMenu(object[p], tmpPath, p)});
	}

	return sm;
}


